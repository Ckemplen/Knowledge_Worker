<tr class="govuk-table__row" id="document-{{ document.id }}" hx-target="this" hx-swap="outerHTML">

    <td class="govuk-table__cell">
        <a href="{{ url_for('document_details', document_id=document.id) }}" class="govuk-link">{{ document.filename
            }}</a>
        <p class="govuk-body">{{document.summary}}</p>
        <p class="govuk-body-small"><i>{{document.last_modified_by}}, {{document.last_modified_at}}</i></p>
    </td>


    <td class="govuk-table__cell">
        <button hx-get="/documents/{{ document.id }}/edit" class="govuk-button govuk-button--secondary">Edit</button>
        <br>
        <button hx-delete="/documents/{{ document.id }}" hx-target="#entities-tab" hx-swap="outerHTML"
            class="govuk-button govuk-button--warning">Delete</button>
    </td>


    <td class="govuk-table__cell">

        {% if document.entities %}
        <details class="govuk-details">
            <summary class="govuk-details__summary">
                <span class="govuk-details__summary-text">
                    Entities
                </span>
            </summary>
            <div class="govuk-details__text">
                
                <form>
                    <div class="govuk-form-group">
                        <label class="govuk-label" for="sort">
                            Add entities
                        </label>
                        <div class="custom-select-container">
                            <input type="text" id="search-box" placeholder="Search options..." onkeyup="filterOptions()">
                            <select class="govuk-select" id="document_entities" name="document_entities" multiple="multiple" hx-get="/document-entity-options/{{document.id}}" hx-trigger="click" hx-swap="innerHTML" hx-target="#document_entities">
                                <!-- Options will be dynamically loaded here -->
                            </select>
                        </div>
                    </div>
                </form>


                <ul class="govuk-list govuk-list--bullet"
                    style="max-height: 150px; overflow-y: auto; overflow-x: hidden; white-space: normal;">
                    {% for entity in document.entities %}
                    <li>{{ entity.entity_name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </details>
        {% endif %}

    </td>

</tr>


<style>
    .custom-select-container {
        position: relative;
    }
    #search-box {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        margin-bottom: 8px;
    }
    .govuk-select {
        width: 100%;
        height: auto;
        max-height: 150px; /* Set the height of the dropdown */
        overflow-y: auto; /* Enable vertical scrolling */
    }
    .govuk-select option[selected]::before {
        content: "âœ”"; /* Checkmark for selected options */
        margin-right: 10px;
    }
</style>


<script>
    function filterOptions() {
        const searchBox = document.getElementById('search-box');
        const filter = searchBox.value.toLowerCase();
        const select = document.getElementById('document_entities');
        const options = select.getElementsByTagName('option');

        for (let i = 0; i < options.length; i++) {
            const option = options[i];
            const text = option.textContent || option.innerText;
            if (text.toLowerCase().indexOf(filter) > -1) {
                option.style.display = "";
            } else {
                option.style.display = "none";
            }
        }
    }

    document.addEventListener('htmx:afterSwap', (event) => {
        if (event.detail.target.id === 'document_entities') {
            filterOptions(); // Initialize the search box and filter options
        }
    });
</script>